@{
    Layout = null;
}
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width" />
    <title>BootStrap框架 - Bootstrap Table</title>
    <link href="../../Content/bootstarp/bootstarp_css/bootstrap.min.css?v=3.3.6" rel="stylesheet" />
    <link href="../../Content/bootstarp/bootstarp_css/font-awesome.css?v=4.4.0" rel="stylesheet" />
    <link href="../../Content/bootstarp/bootstarp_css/bootstrap-table.min.css" rel="stylesheet" />
    <link href="../../Content/bootstarp/bootstarp_css/animate.css" rel="stylesheet" />
    <link href="../../Content/bootstarp/bootstarp_css/style.css?v=4.1.0" rel="stylesheet" />
    <link href="../../Content/bootstarp/bootstarp_css/bootstrap.css" rel="stylesheet" />
    <link href="../../Content/bootstarp/bootstarp_css/bootstrap-table.css" rel="stylesheet" />
    <!-- 日期框JS -->
    <script src="../../Content/H/js/plugins/layer/laydate/laydate.js" type="text/javascript"></script>
    <!-- 日期框 -->
    <link type="text/css" rel="stylesheet" href="../../H/js/plugins/layer/laydate/need/laydate.css" />
    <link type="text/css" rel="stylesheet" href="../../H/js/plugins/layer/laydate/skins/default/laydate.css"
        id="LayDateSkin" />
    <style type="text/css">
    table{  
@*     
    table-layout:fixed;/* 只有定义了表格的布局算法为fixed，下面td的定义才能起作用。 */  
}  
td{  
     width:400px;
    word-break:keep-all;/* 不换行 */  
    white-space:nowrap;/* 不换行 */  
    overflow:hidden;/* 内容超出宽度时隐藏超出部分的内容 */  
    text-overflow:ellipsis;/* 当对象内文本溢出时显示省略标记(...) ；需与overflow:hidden;一起使用。*/  
} *@


    </style>
</head>
<body class="gray-bg">
    <div class="wrapper wrapper-content animated fadeInRight">
        <div class="panel panel-default">
            <div class="panel-heading">
                销售设备订单</div>
            <div class="panel-body">
                <form id="formSearch" name="formSearch" class="form-horizontal" role="form" action=""
                method="post">
                <div id="wherebar" class="form-group" style="margin-top:7px">
                    <label class="control-label col-sm-1" for="GpsDingDanDenno" style="margin-top: 7px">
                        订单编号</label>
                    <div class="col-sm-3" style="margin-top: 7px">
                        <input name="GpsDingDanDenno" type="text" class="form-control" id="GpsDingDanDenno" />
                    </div>
                    <label class="control-label col-sm-1" for="UserName" style="margin-top: 7px">
                        订单用户</label>
                    <div class="col-sm-3" style="margin-top: 7px">
                        <input name="UserName" type="text" class="form-control" id="UserName" />
                    </div>
                    <label class="control-label col-sm-1" for="startDate" style="margin-top: 7px">
                        开始日期</label>
                    <div class="col-sm-3" style="margin-top: 7px">
                        <input name="startDate" class="laydate-icon form-control layer-date" onclick="laydate({ istime: true, format: 'YYYY-MM-DD' })"
                            id="startDate" />
                    </div>
                    <label class="control-label col-sm-1" for="endDate" style="margin-top: 26px">
                        结束日期</label>
                    <div class="col-sm-3" style="margin-top: 26px">
                        <input name="endtDate" class="laydate-icon form-control layer-date" onclick="laydate({ istime: true, format: 'YYYY-MM-DD' })"
                            id="endDate" />
                    </div>
                    <label class="control-label col-sm-1" for="GpsDingDanSH" style="margin-top: 26px">
                        审核状态</label>
                    <div class="col-sm-3" style="margin-top: 26px">
                        <select id="GpsDingDanSH" name="GpsDingDanSH" class="selector"
                            data-live-search="false" style="margin-top: 8px">
                            <option value="0">全部</option>
                            <option value="1">已审核</option>
                            <option value="2">未审核</option>
                        </select>
                    </div>
                    <div class="col-sm-3" style="margin-top: 26px;margin-left:451px">
                        <button type="button"  id="btnSearch" class="btn btn-primary">
                            查询</button>
                    </div>
                </div>
                </form>
            </div>
        </div>
        <div class="ibox-content">
            <table id="exampleTableEvents" data-height="400">
                <thead>
                    <tr>
                        <th data-field="id">
                            序号
                        </th>
                        <th data-field="GpsDingDanDenno">
                            订单编号
                        </th>
                        <th data-field="UserName">
                            订单用户
                        </th>
                        <th data-field="GpsDingDanShuLiang">
                            设备数量
                        </th>
                        <th data-field="GpsDingDanJinE">
                            订单押金
                        </th>
                        <th data-field="GpsDingDanTime">
                            订单日期
                        </th>
                        <th data-field="DGZZCompany">
                            对公转账公司名称
                        </th>
                        <th data-field="DGZH">
                            对公账户
                        </th>
                        <th data-field="DKPZH">
                            打款凭证号
                        </th>
                        <th data-field="GpsDingDanSH">
                            审核状态
                        </th>
                        <th data-field="GpsDingDanRemark">
                            备注
                        </th>
                    </tr>
                </thead>
            </table>
            <div id="toolbar" class="btn-group pull-right" style="margin-right: 20px;">
                <button id="shenhe" type="button" class="btn btn-default">
                    <span class="glyphicon glyphicon-pencil" aria-hidden="true" style="border-radius: 0">
                    </span>审核
                </button>
          @*      <button id="btn_edit" type="button" class="btn btn-default">
                    <span class="glyphicon glyphicon-pencil" aria-hidden="true" style="border-radius: 0">
                    </span>修改
                </button>
                <button id="btn_delete" type="button" class="btn btn-default">
                    <span class="glyphicon glyphicon-remove" aria-hidden="true"></span>删除
                </button>
                <button id="btn_add" type="button" class="btn btn-default">
                    <span class="glyphicon glyphicon-plus" aria-hidden="true"></span>新增
                </button>*@
@*                <button id="daochu" type="button" class="btn btn-default">
                    <span aria-hidden="true" class="glyphicon glyphicon-save"></span>导出
                </button>*@
            </div>
        </div>
    </div>
    <script type="text/javascript" src="../../Content/bootstarp/bootstarp_js/jquery.min.js"></script>
    <script type="text/javascript" src="../../Content/bootstarp/bootstarp_js/bootstrap.js"></script>
    <script type="text/javascript" src="../../Content/bootstarp/bootstarp_js/bootstrap-table.js"></script>
    <script type="text/javascript" src="../../Content/bootstarp/bootstarp_js/bootstrap-table-zh-CN.js"></script>
    <script type="text/javascript" src="../../Content/bootstarp/bootstarp_js/layer.js"></script>
    <script type="text/javascript">
        var $table = $("#exampleTableEvents");
        var TableInit = function () {
            var oTable = new Object();
            oTable.QueryUrl = '@Url.Content("~/SheBeiDingDan/SaleSHIndex")' + '?rnd=' + +Math.random();
            oTable.Init = function () {
                $table.bootstrapTable({
                    method: 'post',
                    contentType: "application/x-www-form-urlencoded",
                    url: oTable.QueryUrl, //请求数据的地址
                    height: $(window).height() + 70,
                    striped: true,     //使表格带有条纹
                    pagination: true,    //在表格底部显示分页工具栏
                    pageNumber: 1,
                    pageSize: 10,
                    pageList: [5, 10, 20, 30],
                    uniqueId: "id",
                    showToggle: true,   //名片格式
                    cardView: false, //设置为True时显示名片（card）布局
                    showColumns: true, //显示隐藏列  
                    showRefresh: false,  //显示刷新按钮
                    search: false, //是否显示右上角的搜索框
                    sidePagination: "server", //表格分页的位置
                    queryParams: oTable.queryParams, //参数
                    singleSelect: true, //单选checkbox 
                    columns: [{ checkbox: true}], //确定显示按钮
                    clickToSelect: true, //是否启用点击选中行
                    toolbarAlign: 'right', //工具栏对齐方式
                    buttonsAlign: 'right', //按钮对齐方式
                    toolbar: "#toolbar", //设置工具栏的Id或者class
                    queryParamsType: "",
                    silent: true,  //刷新事件必须设置
                    formatLoadingMessage: function () {
                        return "请稍等，正在加载中...";
                    },
                    formatNoMatches: function () {  //没有匹配的结果
                        return '无符合条件的记录';
                    },
                    onLoadError: function (data) {
                        $('#exampleTableEvents').bootstrapTable('removeAll');
                    }
                });
            }
            oTable.queryParams = function (params) {
                var temp = {
                    pageSize: params.pageSize,
                    pageIndex: params.pageNumber,
                    sortName: params.sortName,
                    sortOrder: params.sortOrder,
                    startDate: $('#startDate').val(),
                    endDate: $('#endDate').val(),
                    GpsDingDanDenno: $('#GpsDingDanDenno').val(),
                    UserName: $('#UserName').val(),
                    GpsDingDanSH: $('#GpsDingDanSH').val()

                };
                return temp;
            }
            return oTable;
        }
        function queryParams(params) {
            // var params = {};
            $('#wherebar').find('input[name]').each(function () {
                params[$(this).attr('name')] = $(this).val();
            });
            console.log(params);
            return params;
        }
        //初始化表格
        $(function () {
            var myTable = new TableInit();
            myTable.Init();
        });
        //查询
        $("#btnSearch").click(function () {
            $table.bootstrapTable('destroy');
            var myTable = new TableInit();
            myTable.Init();
        });

        $("#exampleTableEvents").on('click-row.bs.table', function (e, row, element) {
            eee = element;
            $('.success').removeClass('success'); //去除之前选中的行的，选中样式
            $(element).addClass('success'); //添加当前选中的 success样式用于区别
        });

        $("#shenhe").click(function () {
            var $table = $("#exampleTableEvents");
            json = $table.bootstrapTable('getSelections');
            if (json == "") {
                alert("请选中要审核的行!")
                return;
            }

            var GpsDingDanDenno = json[0].GpsDingDanDenno;
            //            alert(GpsTuiDanDenno);
            $.ajax({
                url: '/SheBeiDingDan/DataShenheSale',
                type: 'GET', //GET
                async: true,    //或false,是否异步
                data: {
                    GpsDingDanDenno: GpsDingDanDenno
                },
                timeout: 5000,    //超时时间
                dataType: 'json',    //返回的数据格式：json/xml/html/script/jsonp/text
                beforeSend: function (xhr) {
                    console.log(xhr)
                    console.log('发送前')
                },
                success: function (data, textStatus, jqXHR) {
                    if (data.sign = '1') {
                        alert(data.msg);
                        //更新行的审核状态为已审核
                        $table.bootstrapTable("refresh")
                    }
                    else {
                        //                        json[0].GpsTuiDanShenHeZhuangTai.value = "3333";
                        alert(data.msg);
                    }

                },
                error: function (xhr, textStatus) {
                    alert('没有操作权限权限，请联系管理员');
                }
            })

        });

        $("#daochu").click(function () {

            window.location.href = "/SheBeiDingDan/ExportSale?startDate=" + $('#startDate').val()
             + "&" + "endDate=" + $('#endDate').val()
             + "&" + "GpsDingDanDenno=" + $('#GpsDingDanDenno').val()
             + "&" + "UserName=" + $('#UserName').val();
        });

    </script>
</body>
</html>
